<!doctype html>
<html lang="en">
 <head>
  <meta charSet="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Low-level API · Coursier</title>
  <meta name="viewport" content="width=device-width">
  <meta name="generator" content="Docusaurus">
  <meta name="description" content="<blockquote>
<p>This page is a direct import of sections of the <a href=&quot;https://github.com/coursier/coursier/blob/9bc34e2e60a7ec8d49e912e81cf8f02d1620e63c/README.md&quot;>former README</a> of coursier, and is possibly not up-to-date. The use of <a href=&quot;https://github.com/scalameta/mdoc&quot;>mdoc</a> ensures the code snippets below compile fine with the latest version though.</p>
</blockquote>
">
  <meta name="docsearch:version" content="2.0.0-RC2-2">
  <meta name="docsearch:language" content="en">
  <meta property="og:title" content="Low-level API · Coursier">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://get-coursier.io/">
  <meta property="og:description" content="<blockquote>
<p>This page is a direct import of sections of the <a href=&quot;https://github.com/coursier/coursier/blob/9bc34e2e60a7ec8d49e912e81cf8f02d1620e63c/README.md&quot;>former README</a> of coursier, and is possibly not up-to-date. The use of <a href=&quot;https://github.com/scalameta/mdoc&quot;>mdoc</a> ensures the code snippets below compile fine with the latest version though.</p>
</blockquote>
">
  <meta name="twitter:card" content="summary">
  <link rel="shortcut icon" href="../../../undefined">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
  <link rel="alternate" type="application/atom+xml" href="https://get-coursier.io/blog/atom.xml" title="Coursier Blog ATOM Feed">
  <link rel="alternate" type="application/rss+xml" href="https://get-coursier.io/blog/feed.xml" title="Coursier Blog RSS Feed">
  <script type="text/javascript" src="https://buttons.github.io/buttons.js"></script>
  <link rel="stylesheet" href="../../../css/main.css">
  <script src="/js/codetabs.js"></script>
 </head>
 <body class="sideNavVisible separateOnPageNav">
  <div class="fixedHeaderContainer">
   <div class="headerWrapper wrapper">
    <header>
     <a href="../../.."><h2 class="headerTitle">Coursier</h2></a>
     <a href="../../../versions"><h3>2.0.0-RC2-2</h3></a>
     <div class="navigationWrapper navigationSlider">
      <nav class="slidingNav">
       <ul class="nav-site nav-site-internal">
        <li class="siteNavGroupActive"><a href="../../../docs/2.0.0-RC2-2/overview" target="_self">Docs</a></li>
        <li class=""><a href="../../../blog" target="_self">Blog</a></li>
        <li class=""><a href="https://github.com/coursier/coursier" target="_self">GitHub</a></li>
        <li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"></li>
       </ul>
      </nav>
     </div>
    </header>
   </div>
  </div>
  <div class="navPusher">
   <div class="docMainWrapper wrapper">
    <div class="container docsNavContainer" id="docsNav">
     <nav class="toc">
      <div class="toggleNav">
       <section class="navWrapper wrapper">
        <div class="navBreadcrumb wrapper">
         <div class="navToggle" id="navToggler">
          <div class="hamburger-menu">
           <div class="line1"></div>
           <div class="line2"></div>
           <div class="line3"></div>
          </div>
         </div>
         <h2><i>›</i><span>API</span></h2>
         <div class="tocToggler" id="tocToggler">
          <i class="icon-toc"></i>
         </div>
        </div>
        <div class="navGroups">
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">Intro</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/overview">Overview</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/overview-motivations">Motivations</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/overview-in-the-wild">Users</a></li>
          </ul>
         </div>
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">sbt plugins</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/sbt-coursier">sbt-coursier</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/sbt-pgp-coursier">sbt-pgp-coursier</a></li>
          </ul>
         </div>
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">Command-line</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-overview">Overview</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-resolve">resolve</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-fetch">fetch</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-launch">launch</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-bootstrap">bootstrap</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cli-native-bootstrap">scala-native bootstrap</a></li>
          </ul>
         </div>
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">API</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/api">API</a></li>
           <li class="navListItem navListItemActive"><a class="navItem" href="../../../docs/2.0.0-RC2-2/api-low-level">Low-level API</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/api-scala-js">Scala.js</a></li>
          </ul>
         </div>
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">Other</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/cache">Cache</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/ttl">TTL</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/other-repositories">Repositories</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/other-credentials">Credentials</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/other-proxy">Proxy</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/json-report">JSON report</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/extra">Extra</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/limitations">Limitations</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/faq">FAQ</a></li>
          </ul>
         </div>
         <div class="navGroup">
          <h3 class="navGroupCategoryTitle">Development</h3>
          <ul class="">
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/dev-contributing">Contributing</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/dev-cli">CLI</a></li>
           <li class="navListItem"><a class="navItem" href="../../../docs/2.0.0-RC2-2/dev-website">Website</a></li>
          </ul>
         </div>
        </div>
       </section>
      </div>
      <script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script>
     </nav>
    </div>
    <div class="container mainContainer">
     <div class="wrapper">
      <div class="post">
       <header class="postHeader">
        <a class="edit-page-link button" href="https://github.com/coursier/coursier/edit/master/doc/docs/api-low-level.md" target="_blank" rel="noreferrer noopener">Edit</a>
        <h1 class="postHeaderTitle">Low-level API</h1>
       </header>
       <article>
        <div>
         <span>
          <blockquote> 
           <p>This page is a direct import of sections of the <a href="https://github.com/coursier/coursier/blob/9bc34e2e60a7ec8d49e912e81cf8f02d1620e63c/README.md">former README</a> of coursier, and is possibly not up-to-date. The use of <a href="https://github.com/scalameta/mdoc">mdoc</a> ensures the code snippets below compile fine with the latest version though.</p> 
          </blockquote> <p>Add to your <code>build.sbt</code></p> <pre><code class="hljs css language-scala">libraryDependencies ++= <span class="hljs-type">Seq</span>(
  <span class="hljs-string">"io.get-coursier"</span> %% <span class="hljs-string">"coursier-core"</span> % <span class="hljs-string">"2.0.0-RC2-2"</span>,
  <span class="hljs-string">"io.get-coursier"</span> %% <span class="hljs-string">"coursier-cache"</span> % <span class="hljs-string">"2.0.0-RC2-2"</span>
)
</code></pre> <p>The first module, <code>"io.get-coursier" %% "coursier-core" % "2.0.0-RC2-2"</code>, contains among others, definitions, mainly in <a href="https://github.com/coursier/coursier/blob/master/core/shared/src/main/scala/coursier/core/Definitions.scala"><code>Definitions.scala</code></a>, <a href="https://github.com/coursier/coursier/blob/master/core/shared/src/main/scala/coursier/core/Resolution.scala"><code>Resolution</code></a>, representing a particular state of the resolution, and <a href="https://github.com/coursier/coursier/blob/master/core/shared/src/main/scala/coursier/core/ResolutionProcess.scala"><code>ResolutionProcess</code></a>, that expects to be given metadata, wrapped in any <code>Monad</code>, then feeds these to <code>Resolution</code>, and at the end gives you the final <code>Resolution</code>, wrapped in the same <code>Monad</code> it was given input. This final <code>Resolution</code> has all the dependencies, including the transitive ones.</p> <p>The second module, <code>"io.get-coursier" %% "coursier-cache" % "2.0.0-RC2-2"</code>, is precisely in charge of fetching these input metadata. It uses its own <code>coursier.util.Task</code> as a <code>Monad</code> to wrap them. It also fetches artifacts (JARs, etc.). It caches all of these (metadata and artifacts) on disk, and validates checksums too.</p> <p>In the code below, we'll assume some imports are around,</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> coursier._
</code></pre> <p>Resolving dependencies involves create an initial resolution state, with all the initial dependencies in it, like</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> start = <span class="hljs-type">Resolution</span>(
  <span class="hljs-type">Seq</span>(
    <span class="hljs-type">Dependency</span>(
      <span class="hljs-type">Module</span>(<span class="hljs-string">org"org.typelevel"</span>, <span class="hljs-string">name"cats-core_2.11"</span>), <span class="hljs-string">"0.6.0"</span>
    ),
    <span class="hljs-type">Dependency</span>(
      <span class="hljs-type">Module</span>(<span class="hljs-string">org"org.scalaz"</span>, <span class="hljs-string">name"scalaz-core_2.11"</span>), <span class="hljs-string">"7.2.3"</span>
    )
  )
)
</code></pre> <p>It goes without saying that a <code>Resolution</code> is immutable, as are all the classes defined in the core module. The resolution process will go on by giving successive <code>Resolution</code>s, until the final one.</p> <p><code>start</code> above is only the initial state - it is far from over, as the <code>isDone</code> method on it tells,</p> <pre><code class="hljs css language-scala">start.isDone
<span class="hljs-comment">// res0: Boolean = false</span>
</code></pre> <p>In order for the resolution to go on, we'll need things from a few repositories,</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> repositories = <span class="hljs-type">Seq</span>(
  coursier.<span class="hljs-type">LocalRepositories</span>.ivy2Local,
  <span class="hljs-type">MavenRepository</span>(<span class="hljs-string">"https://repo1.maven.org/maven2"</span>)
)
</code></pre> <p>The first one, <code>Cache.ivy2Local</code>, is defined in <code>coursier.Cache</code>, itself from the <code>coursier-cache</code> module that we added above. It is an <code>IvyRepository</code>, picking things under <code>~/.ivy2/local</code>. An <code>IvyRepository</code> is related to the <a href="http://ant.apache.org/ivy/">Ivy</a> build tool. This kind of repository involves a so-called <a href="http://ant.apache.org/ivy/history/2.4.0/concept.html#patterns">pattern</a>, with various properties. These are not of very common use in Scala, although sbt uses them a bit.</p> <p>The second repository is a <code>MavenRepository</code>. These are simpler than the Ivy repositories. They're the ones we're the most used to in Scala. Common ones like <a href="https://repo1.maven.org/maven2">Central</a> like here, or the repositories from <a href="https://oss.sonatype.org/content/repositories/">Sonatype</a>, are Maven repositories. These originate from the <a href="https://maven.apache.org/">Maven</a> build tool. Unlike the Ivy repositories which involve customisable patterns to point to the underlying metadata and artifacts, the paths of these for Maven repositories all look alike, like for any particular version of the standard library, under paths like <a href="http://repo1.maven.org/maven2/org/scala-lang/scala-library/2.11.7/">this one</a>.</p> <p>Both <code>IvyRepository</code> and <code>MavenRepository</code> are case classes, so that it's straightforward to specify one's own repositories.</p> <p>To set credentials for a <code>MavenRepository</code> or <code>IvyRepository</code>, set their <code>authentication</code> field, like</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> coursier.core.<span class="hljs-type">Authentication</span>

<span class="hljs-type">MavenRepository</span>(
  <span class="hljs-string">"https://nexus.corp.com/content/repositories/releases"</span>,
  authentication = <span class="hljs-type">Some</span>(<span class="hljs-type">Authentication</span>(<span class="hljs-string">"user"</span>, <span class="hljs-string">"pass"</span>))
)
</code></pre> <p>Now that we have repositories, we're going to mix these with things from the <code>coursier-cache</code> module, for resolution to happen via the cache. We'll create a function of type <code>Seq[(Module, String)] =&gt; F[Seq[((Module, String), Either[Seq[String], (Artifact.Source, Project)])]]</code>. Given a sequence of dependencies, designated by their <code>Module</code> (organisation and name in most cases) and version (just a <code>String</code>), it gives either errors (<code>Seq[String]</code>) or metadata (<code>(Artifact.Source, Project)</code>), wrapping the whole in a monad <code>F</code>.</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> coursier.cache.<span class="hljs-type">Cache</span>

<span class="hljs-keyword">val</span> fetch = <span class="hljs-type">ResolutionProcess</span>.fetch(repositories, <span class="hljs-type">Cache</span>.<span class="hljs-keyword">default</span>.fetch)
</code></pre> <p>The monad used by <code>Fetch.from</code> is <code>coursier.util.Task</code>, but the resolution process is not tied to a particular monad - any stack-safe monad would do.</p> <p>With this <code>fetch</code> method, we can now go on with the resolution. Calling <code>process</code> on <code>start</code> above gives a <a href="https://github.com/coursier/coursier/blob/master/core/shared/src/main/scala/coursier/core/ResolutionProcess.scala"><code>ResolutionProcess</code></a>, that drives the resolution. It is loosely inspired by the <code>Process</code> of <a href="http://fs2.io/">fs2</a> (formerly scalaz-stream). It is an immutable structure, that represents the various states the resolution process can be in.</p> <p>Its method <code>current</code> gives the current <code>Resolution</code>. Calling <code>isDone</code> on the latter says whether the resolution is done or not.</p> <p>The <code>next</code> method, that expects a <code>fetch</code> method like the one above, gives the "next" state of the resolution process, wrapped in the monad of the <code>fetch</code> method. It allows to do one resolution step.</p> <p>Lastly, the <code>run</code> method runs the whole resolution until its end. It expects a <code>fetch</code> method too, and will make at most <code>maxIterations</code> steps (50 by default), and return the "final" resolution state, wrapped in the monad of <code>fetch</code>. One should check that the <code>Resolution</code> it returns is done (<code>isDone</code>) - the contrary means that <code>maxIterations</code> were reached, likely signaling an issue, unless the underlying resolution is particularly complex, in which case <code>maxIterations</code> could be increased.</p> <p>Let's run the whole resolution,</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContext</span>.<span class="hljs-type">Implicits</span>.global

<span class="hljs-keyword">val</span> resolution = start.process.run(fetch).unsafeRun()
</code></pre> <p>To get additional feedback during the resolution, we can give the <code>Cache.fetch</code> method above a <a href="https://github.com/coursier/coursier/blob/cf269c6895e19f2d590f08811406724304332950/cache/src/main/scala/coursier/Cache.scala#L484-L490"><code>Cache.Logger</code></a>.</p> <p>By default, downloads happen in a global fixed thread pool (with 6 threads, allowing for 6 parallel downloads), but you can supply your own thread pool to <code>Cache.fetch</code>.</p> <p>Now that the resolution is done, we can check for errors in</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> errors: <span class="hljs-type">Seq</span>[((<span class="hljs-type">Module</span>, <span class="hljs-type">String</span>), <span class="hljs-type">Seq</span>[<span class="hljs-type">String</span>])] = resolution.errors
</code></pre> <p>These would mean that the resolution wasn't able to get metadata about some dependencies.</p> <p>We can also check for version conflicts, in</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> conflicts: <span class="hljs-type">Set</span>[<span class="hljs-type">Dependency</span>] = resolution.conflicts
</code></pre> <p>which are dependencies whose versions could not be unified.</p> <p>Then, if all went well, we can fetch and get local copies of the artifacts themselves (the JARs) with</p> <pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> java.io.<span class="hljs-type">File</span>
<span class="hljs-keyword">import</span> coursier.cache.{<span class="hljs-type">ArtifactError</span>, <span class="hljs-type">Cache</span>}
<span class="hljs-keyword">import</span> coursier.util.{<span class="hljs-type">Gather</span>, <span class="hljs-type">Task</span>}

<span class="hljs-keyword">val</span> localArtifacts: <span class="hljs-type">Seq</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">ArtifactError</span>, <span class="hljs-type">File</span>]] =
  <span class="hljs-type">Gather</span>[<span class="hljs-type">Task</span>].gather(
    resolution.artifacts().map(<span class="hljs-type">Cache</span>.<span class="hljs-keyword">default</span>.file(_).run)
  ).unsafeRun()
</code></pre> <p>We're using the <code>Cache.file</code> method, that can also be given a <code>Logger</code> (for more feedback) and a custom thread pool.</p> </span>
        </div>
       </article>
      </div>
      <div class="docs-prevnext">
       <a class="docs-prev button" href="../../../docs/2.0.0-RC2-2/api"><span class="arrow-prev">← </span><span>API</span></a>
       <a class="docs-next button" href="../../../docs/2.0.0-RC2-2/api-scala-js"><span>Scala.js</span><span class="arrow-next"> →</span></a>
      </div>
     </div>
    </div>
    <nav class="onPageNav"></nav>
   </div>
   <footer class="nav-footer" id="footer">
    <section class="sitemap">
     <h2><a href="../../.." class="nav-home">Coursier</a></h2>
     <div>
      <h5>Docs</h5>
      <a href="../../../docs/overview">Overview</a>
      <a href="../../../docs/cli-overview">Install CLI</a>
      <a href="../../../docs/sbt-coursier">Setup sbt</a>
      <a href="../../../docs/api">Use the API</a>
     </div>
     <div>
      <h5>Community</h5>
      <a href="https://github.com/coursier/coursier" target="_blank"><img src="https://img.shields.io/github/stars/coursier/coursier.svg?color=%23087e8b&amp;label=stars&amp;logo=github&amp;style=social"></a>
      <a href="https://gitter.im/coursier/coursier" target="_blank"><img src="https://img.shields.io/gitter/room/coursier/coursier.svg?logo=gitter&amp;style=social"></a>
     </div>
    </section>
    <section class="copyright">
     Copyright © 2019 coursier contributors
    </section>
   </footer>
  </div>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
  <script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script>
  <script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script>
  <script>
              var search = docsearch({
                
                apiKey: '53a7a919d6905f94dafd59e25d0f5e5d',
                indexName: 'get-coursier',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script>
 </body>
</html>